{% extends 'base.html.twig' %}

{# {% block title  Offer index%} #}
	



{% block body %}

	<h1>
		index offer
	</h1>
	<main id="main" class="main ">

		<section class="section dashboard">
			<div class="row">
				<h2 class="text-center text-uppercase fw-bold mb-4">Nos forfaits limités
				</h2>
				<!-- Sales Card -->
				{% for offer in offers|filter(offre => offre.type == "LIMITE") %}
					<div class="col-xxl-4 col-md-16" data-bs-toggle="modal" data-bs-target="#exampleModal" data-offerid="{{offer.id}}" data-title="{{offer.quantity}} Go" data-deadline="{{offer.deadLine}} Jrs" data-price="{{offer.price}}">
						<div class="card info-card sales-card" style="height: 100%;">
							<div
								class="card-body d-flex p-2" style="height: 100%;">
								<!-- Première moitié en jaune -->
								<div class="bg-yellow d-flex align-items-center justify-content-center" style="flex: 1; height: 100%; box-sizing: border-box; padding: 0; margin: 0;">
									<h5 class="card-title m-0">{{offer.quantity}}
										Go
										<span>|{{offer.deadLine}}
											Jrs</span>
									</h5>
								</div>

								<!-- Deuxième moitié -->
								<div class="d-flex align-items-center justify-content-center" style="flex: 1; height: 100%; box-sizing: border-box; padding: 0; margin: 0;">
									<div class="d-flex align-items-center">
										<div
											class="card-icon rounded-circle d-flex align-items-center justify-content-center">
											<!-- Icône monétaire représentant la devise -->
											<i class="bi bi-cash"></i>
										</div>
										<div class="ps-3">
											<h6>{{offer.price}}</h6>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				{% endfor %}

				<!-- End Sales Card -->


			</div>

			<div class="row mt-5">
				<h2 class="text-center text-uppercase fw-bold mb-4">Nos forfaits illimités
				</h2>
				<!-- Sales Card -->
				{% for offer in offers|filter(offre => offre.type == "ILLIMITE") %}
					<div class="col-xxl-4 col-md-16" data-bs-toggle="modal" data-bs-target="#exampleModal" data-offerid="{{offer.id}}" data-title="{{offer.quantity}} Go" data-deadline="{{offer.deadLine}} Jrs" data-price="{{offer.price}}">
						<div class="card info-card sales-card" style="height: 100%;">
							<div
								class="card-body d-flex p-2" style="height: 100%;">
								<!-- Première moitié en jaune -->
								<div class="bg-yellow d-flex align-items-center justify-content-center" style="flex: 1; height: 100%; box-sizing: border-box; padding: 0; margin: 0;">
									<h5 class="card-title m-0">{{offer.quantity}}
										Go
										<span>|
											{{offer.deadLine}}
											Jrs</span>
									</h5>
								</div>

								<!-- Deuxième moitié -->
								<div class="d-flex align-items-center justify-content-center" style="flex: 1; height: 100%; box-sizing: border-box; padding: 0; margin: 0;">
									<div class="d-flex align-items-center">
										<div
											class="card-icon rounded-circle d-flex align-items-center justify-content-center">
											<!-- Icône monétaire représentant la devise -->
											<i class="bi bi-cash"></i>
										</div>
										<div class="ps-3">
											<h6>{{offer.price}}</h6>
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
				{% endfor %}
				<!-- End Sales Card -->

			</div>

			<!-- Modal commun -->
			<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<form action="{{path('app_offer_index')}}" method="post">
							<div class="modal-header">
								<h5 class="modal-title" id="exampleModalLabel">Détails</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<input type="hidden" name="offerId" id="offerId">
								<p>
									<strong>Offre :</strong>
									<span id="modal-title">---</span>
								</p>
								<p>
									<strong>Durée :</strong>
									<span id="modal-deadline">---</span>
								</p>
								<p>
									<strong>Prix :</strong>
									<span id="modal-price">---</span>
									FCFA</p>
								<div class="mb-3">
									<label for="accountNumber" class="form-label">Compte à débiter</label>
									<select name="accountNumber" class="form-control" id="accountNumber">
										<option value="">-- Sélectionnez un compte momo --</option>
										{% for account in accounts %}
											<option value="{{ account.id }} " data-momo-number="{{ account.momoNumber }}">{{ account.momoNumber }}</option>
										{% endfor %}
									</select>
								</div>

							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
								{# <button type="submit" class="btn btn-primary">Confirmer</button> #}
								{# <form action="{{ path('app_payment_index') }}" method="get">
    								<button type="submit" class="btn btn-primary">Confirmer</button>
								</form> #}

								 {# <a href="{{ path('app_home', {'price':{{offer.price}}}) }}" class="btn btn-primary">Confirmer</a>  #}
																{# <button id="pay-btn" >Payer</button> #}
                    <!-- URL générée par Symfony, injectée dans un attribut data-url -->
                    {# <button type="button" id="pay-btn" data-url="{{ path('app_home', {'price': '__price__'}) }}">Payer</button> #}
					{# <button type="button" id="pay-btn" data-url="{{ path('app_home', {'price': '__price__', 'momoNumber': '__momoNumber__'}) }}">Payer</button> #}
{# 
					<form action="{{ path('app_home') }}" method="POST">
						
						<input type="hidden" name="price" id="price" value="" required >

						<input type="hidden" name="acountNumber" id="acountnumber" value="" required >

						<button type="submit" id="pay-btn" data-url="{{ path('app_home') }}" name="pay-btn">Confirmer</button>
					</form> #}

					<form action="{{ path('app_home') }}" method="POST">
    <input type="hidden" name="price" id="price" value="" required>
    <input type="hidden" name="acountnumber" id="acountnumber" value="" required>
	<input type="hidden" name="offerid" id="offerid" value="">
	
    <button type="submit" id="pay-btn" data-url="{{ path('app_home') }}" name="pay-btn">Confirmer</button>
</form>


{# 
								<script>
									
								FedaPay.init( pay, { public_key: "pk_sandbox_iMMuINy2vZInv2_fTlBgYxwc" });

								</script> #}
								
									
								

							</div>
						</form>
					</div>
				</div>
			</div>
		</section>

		<!-- Script JavaScript -->
		<script>
			

			var modal = document.getElementById('exampleModal');
			modal.addEventListener('show.bs.modal', function (event) { // Récupère l'élément déclencheur (la carte)
			var button = event.relatedTarget;


			// Récupère les données de l'offre depuis les attributs data-*
			var title = button.getAttribute('data-title');
			var price = button.getAttribute('data-price');
			var offerId = button.getAttribute('data-offerid');
			var deadline = button.getAttribute('data-deadline');
			

			//price en int
			var priceInt = parseInt(price, 10); 


			// Cible les éléments du modal
			var modalTitle = modal.querySelector('.modal-title');
			var modalBodyTitle = modal.querySelector('#modal-title');
			var modalBodyPrice = modal.querySelector('#modal-price');
			var modalBodyDeadline = modal.querySelector('#modal-deadline');
			var offerIdInput = modal.querySelector('#offerId');
			var pay = modal.querySelector('#pay-btn');

			var form_price =  modal.querySelector('#price');
			var form_acountNumber = modal.querySelector('#acountnumber');
			var form_idoffer = modal.querySelector('#offerid')

	
			// Met à jour le contenu du modal
			modalTitle.textContent = 'Détails de l\'offre';
			modalBodyTitle.textContent = title;
			modalBodyPrice.textContent = price;
			modalBodyDeadline.textContent = deadline;
			offerIdInput.value = offerId;


			// Met à jour les valeurs des inputs cachés
				form_price.value = price;
				form_accountNumber.value =64000000 ; //momoNumber
				form_idoffer.value = offerId;

				
					// Ajoute un écouteur d'événement pour récupérer le numéro de compte
			const accountSelect = document.getElementById('accountNumber');
			accountSelect.addEventListener('change', function () {
				const selectedOption = accountSelect.options[accountSelect.selectedIndex];
				const momoNumber = selectedOption.getAttribute('data-momo-number');
				
				

			});
		});

		var payBtn = document.getElementById('pay-btn');

		// Soumettre le formulaire lors du clic sur le bouton "Confirmer"
		payBtn.addEventListener('click', function (event) {
			var form = document.querySelector('form');  // Récupère le formulaire parent
			form.submit();  // Soumet le formulaire
		});
			
			
		</script>


		<!-- Style -->
		<style>
			.bg-yellow {
				background-color: yellow;
				/* Remplit entièrement la moitié jaune */
			}

			.card {
				height: 100%;
				/* Assure que la carte occupe la même taille que les autres */
			}

			.card-body {
				display: flex;
				height: 100%;
			}

			.card-title {
				margin: 0;
				/* Supprime les marges des titres */
			}
		</style>

	</main>


	

        
						              {% endblock %}
